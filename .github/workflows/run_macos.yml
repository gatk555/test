name: Run MacOS
on:
  workflow_dispatch:
  push:

jobs:
  run:
    runs-on: macos-latest
    steps:
      - uses: dawidd6/action-download-artifact@v2
        with:
         workflow: macos.yml
         run_number: 1
         name: Test Macos X86_64
         path: /usr/local
      - name: Install Dependencies
        run: |
          brew install verilator
          brew install ncurses readline libxaw libatomic_ops
      - uses: actions/checkout@v3
      - name: Run
        run: |
          verilator --Mdir adc_obj_dir --prefix Vlng --CFLAGS -fpic --compiler clang --cc  --build --exe --CFLAGS -I/usr/local/share/ngspice/scripts/src /usr/local/share/ngspice/scripts/src/*.cpp /usr/local/share/ngspice/examples/xspice/verilator/adc.v
          ls adc_obj_dir
          chmod a+x /usr/local/bin/ngspice
          ngspice -b vlnggen  /usr/local/share/ngspice/examples/xspice/verilator/adc.v
          ls  adc_obj_dir
          mv adc.so adc.DLL
          echo Testing ...
          ngspice -b -r adc.raw adc_batch.cir
          mkdir ~/results
          cp *.raw ~/results
      - name: Save
        uses: actions/upload-artifact@v3
        with:
          name: Results
          path: ~/results
